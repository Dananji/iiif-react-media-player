"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("video.js"),r=require("manifesto.js");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=n(e),i=n(t);var o=function(e){if(Array.isArray(e))return e};var u=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(n=(o=u.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw i}}return r}};var s=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n};var l=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}};var c=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var f=function(e,t){return o(e)||u(e,t)||l(e,t)||c()};var d=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e};function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var y=a.default.createContext(),v=a.default.createContext(),g={manifest:null,canvasIndex:0,currentNavItem:null};function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"updateManifest":return p(p({},e),{},{manifest:p({},t.manifest)});case"switchCanvas":return p(p({},e),{},{canvasIndex:t.canvasIndex});case"switchItem":return p(p({},e),{},{currentNavItem:t.item});default:throw new Error("Unhandled action type: ".concat(t.type))}}function b(e){var t=e.initialState,r=void 0===t?g:t,n=e.children,i=a.default.useReducer(h,r),o=f(i,2),u=o[0],s=o[1];return a.default.createElement(y.Provider,{value:u},a.default.createElement(v.Provider,{value:s},n))}function k(){var e=a.default.useContext(y);if(void 0===e)throw new Error("useManifestState must be used within a ManifestProvider");return e}function O(){var e=a.default.useContext(v);if(void 0===e)throw new Error("useManifestDispatch must be used within a ManifestProvider");return e}function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var x=a.default.createContext(),E=a.default.createContext(),w={player:null,clickedUrl:"",isCaptionOn:!1,isClicked:!1,isPlaying:!1,startTime:null,endTime:null,isEnded:!1,currentTime:null};function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"updatePlayer":return j(j({},e),{},{player:t.player});case"navClick":return j(j({},e),{},{clickedUrl:t.clickedUrl,isClicked:!0});case"resetClick":return j(j({},e),{},{isClicked:!1});case"setTimeFragment":return j(j({},e),{},{startTime:parseInt(t.startTime),endTime:parseInt(t.endTime)});case"setPlayingStatus":return j(j({},e),{},{isPlaying:t.isPlaying});case"setCaptionStatus":return j(j({},e),{},{captionOn:t.captionOn});case"setIsEnded":return j(j({},e),{},{isEnded:t.isEnded});case"setCurrentTime":return j(j({},e),{},{currentTime:t.currentTime});default:throw new Error("Unhandled action type: ".concat(t.type))}}function S(e){var t=e.initialState,r=void 0===t?w:t,n=e.children,i=a.default.useReducer(P,r),o=f(i,2),u=o[0],s=o[1];return a.default.createElement(x.Provider,{value:u},a.default.createElement(E.Provider,{value:s},n))}function I(){var e=a.default.useContext(x);if(void 0===e)throw new Error("usePlayerState must be used within the PlayerProvider");return e}function C(){var e=a.default.useContext(E);if(void 0===e)throw new Error("usePlayerDispatch must be used within the PlayerProvider");return e}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function M(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}function A(){}function R(){}R.resetWarningCache=A;var q=M((function(e){e.exports=function(){function e(e,t,r,n,a,i){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==i){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var r={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:R,resetWarningCache:A};return r.PropTypes=r,r}()}));function D(t){var r=t.manifestUrl,n=t.children,i=t.manifest,o=e.useState(i),u=f(o,2),s=u[0],l=u[1],c=O();return e.useEffect((function(){s?c({manifest:s,type:"updateManifest"}):fetch(r).then((function(e){return e.json()})).then((function(e){l(e),c({manifest:e,type:"updateManifest"})}))}),[]),s?a.default.createElement("section",{className:"iiif-player"},n):a.default.createElement("p",null,"...Loading")}function U(e){var t=e.manifestUrl,r=e.manifest,n=e.children;return t||r?a.default.createElement(b,null,a.default.createElement(S,null,a.default.createElement(D,{manifestUrl:t,manifest:r},n))):a.default.createElement("p",null,"Please provide a manifest or manifestUrl.")}D.propTypes={manifest:q.object,manifestUrl:q.string,children:q.node},U.propTypes={manifestUrl:q.string},U.defaultProps={};var N=M((function(e){function t(){return e.exports=t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},t.apply(this,arguments)}e.exports=t}));var _=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a};var L=function(e,t){if(null==e)return{};var r,n,a=_(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a},B=(M((function(e,t){!function(e){var t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(e){return"Break: "+e.text},time:function(e){return e.time}},breakOverlay:{display:!1,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(e){},onMarkerReached:function(e,t){},markers:[]};function i(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)}))}function o(e){var t,r={top:0,bottom:0,left:0,width:0,height:0,right:0};try{t=e.getBoundingClientRect()}catch(e){t=r}return t}var u=-1;function s(e){if(!t.default.mergeOptions){var r=function(e){return!!e&&"object"===(void 0===e?"undefined":n(e))&&"[object Object]"===toString.call(e)&&e.constructor===Object},s=function e(t,n){var a={};return[t,n].forEach((function(t){t&&Object.keys(t).forEach((function(n){var i=t[n];r(i)?(r(a[n])||(a[n]={}),a[n]=e(a[n],i)):a[n]=i}))})),a};t.default.mergeOptions=s}t.default.dom.createEl||(t.default.dom.createEl=function(e,r,n){var a=t.default.Player.prototype.dom.createEl(e,r);return n&&Object.keys(n).forEach((function(e){a.setAttribute(e,n[e])})),a});var l=t.default.mergeOptions(a,e),c={},f=[],d=u,m=this,p=null,y=null,v=u;function g(){f.sort((function(e,t){return l.markerTip.time(e)-l.markerTip.time(t)}))}function h(e){e.forEach((function(e){e.key=i(),m.el().querySelector(".vjs-progress-holder").appendChild(O(e)),c[e.key]=e,f.push(e)})),g()}function b(e){return l.markerTip.time(e)/m.duration()*100}function k(e,t){t.className="vjs-marker "+(e.class||""),Object.keys(l.markerStyle).forEach((function(e){t.style[e]=l.markerStyle[e]}));var r=e.time/m.duration();if((r<0||r>1)&&(t.style.display="none"),t.style.left=b(e)+"%",e.duration)t.style.width=e.duration/m.duration()*100+"%",t.style.marginLeft="0px";else{var n=o(t);t.style.marginLeft=n.width/2+"px"}}function O(e){var r=t.default.dom.createEl("div",{},{"data-marker-key":e.key,"data-marker-time":l.markerTip.time(e)});return k(e,r),r.addEventListener("click",(function(t){var r=!1;if("function"==typeof l.onMarkerClick&&(r=!1===l.onMarkerClick(e)),!r){var n=this.getAttribute("data-marker-key");m.currentTime(l.markerTip.time(c[n]))}})),l.markerTip.display&&x(r),r}function T(e){f.forEach((function(t){var r=m.el().querySelector(".vjs-marker[data-marker-key='"+t.key+"']"),n=l.markerTip.time(t);(e||r.getAttribute("data-marker-time")!==n)&&(k(t,r),r.setAttribute("data-marker-time",n))})),g()}function j(e){y&&(v=u,y.style.visibility="hidden"),d=u;var t=[];e.forEach((function(e){var r=f[e];if(r){delete c[r.key],t.push(e);var n=m.el().querySelector(".vjs-marker[data-marker-key='"+r.key+"']");n&&n.parentNode.removeChild(n)}})),t.reverse(),t.forEach((function(e){f.splice(e,1)})),g()}function x(e){e.addEventListener("mouseover",(function(){var t=c[e.getAttribute("data-marker-key")];if(p){l.markerTip.html?p.querySelector(".vjs-tip-inner").innerHTML=l.markerTip.html(t):p.querySelector(".vjs-tip-inner").innerText=l.markerTip.text(t),p.style.left=b(t)+"%";var r=o(p),n=o(e);p.style.marginLeft=-parseFloat(r.width/2)+parseFloat(n.width/4)+"px",p.style.visibility="visible"}})),e.addEventListener("mouseout",(function(){p&&(p.style.visibility="hidden")}))}function E(){p=t.default.dom.createEl("div",{className:"vjs-tip",innerHTML:"<div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div>"}),m.el().querySelector(".vjs-progress-holder").appendChild(p)}function w(){if(l.breakOverlay.display&&!(d<0)){var e=m.currentTime(),t=f[d],r=l.markerTip.time(t);e>=r&&e<=r+l.breakOverlay.displayTime?(v!==d&&(v=d,y&&(y.querySelector(".vjs-break-overlay-text").innerHTML=l.breakOverlay.text(t))),y&&(y.style.visibility="visible")):(v=u,y&&(y.style.visibility="hidden"))}}function P(){y=t.default.dom.createEl("div",{className:"vjs-break-overlay",innerHTML:"<div class='vjs-break-overlay-text'></div>"}),Object.keys(l.breakOverlay.style).forEach((function(e){y&&(y.style[e]=l.breakOverlay.style[e])})),m.el().appendChild(y),v=u}function S(){I(),w(),e.onTimeUpdateAfterMarkerUpdate&&e.onTimeUpdateAfterMarkerUpdate()}function I(){if(f.length){var t=function(e){return e<f.length-1?l.markerTip.time(f[e+1]):m.duration()},r=m.currentTime(),n=u;if(d!==u){var a=t(d);if(r>=l.markerTip.time(f[d])&&r<a)return;if(d===f.length-1&&r===m.duration())return}if(r<l.markerTip.time(f[0]))n=u;else for(var i=0;i<f.length;i++)if(a=t(i),r>=l.markerTip.time(f[i])&&r<a){n=i;break}n!==d&&(n!==u&&e.onMarkerReached&&e.onMarkerReached(f[n],n),d=n)}}function C(){l.markerTip.display&&E(),m.markers.removeAll(),h(l.markers),l.breakOverlay.display&&P(),S(),m.on("timeupdate",S),m.off("loadedmetadata")}m.on("loadedmetadata",(function(){C()})),m.markers={getMarkers:function(){return f},next:function(){for(var e=m.currentTime(),t=0;t<f.length;t++){var r=l.markerTip.time(f[t]);if(r>e){m.currentTime(r);break}}},prev:function(){for(var e=m.currentTime(),t=f.length-1;t>=0;t--){var r=l.markerTip.time(f[t]);if(r+.5<e)return void m.currentTime(r)}},add:function(e){h(e)},remove:function(e){j(e)},removeAll:function(){for(var e=[],t=0;t<f.length;t++)e.push(t);j(e)},updateTime:function(e){T(e)},reset:function(e){m.markers.removeAll(),h(e)},destroy:function(){m.markers.removeAll(),y&&y.remove(),p&&p.remove(),m.off("timeupdate",w),delete m.markers}}}t.default.registerPlugin("markers",s)}(i.default)})),M((function(e){function t(r){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(r)}e.exports=t})));function F(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return H(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw i}}}}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function V(e){var t=e.rangeId,n=e.manifest,a=[];try{a=r.parseManifest(n).getRangeById(t).getCanvasIds()}catch(e){console.log("error fetching range canvases")}return a}function W(e){if(void 0===e);else{var t=e.split("#t=")[1];if(void 0!==t){var r=t.split(",");return{start:r[0],stop:r[1]}}}}function $(e){var t=e.canvasIndex,n=e.manifest;return r.parseManifest(n).getSequences()[0].getCanvases().map((function(e){return e.id})).length-1>t}function Y(e){if(e.items)return e.items[0].id}function z(e){var t=e.manifest,r=e.canvasIndex;if(!t.structures)return[];var n=t.structures[0].items[r],a=[];return function e(r){if(1!=V({rangeId:r.id,manifest:t}).length){var n,i=F(r.items);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.items&&(1==o.items.length&&"Canvas"===o.items[0].type?a.push(o):e(o))}}catch(e){i.e(e)}finally{i.f()}}else a.push(r)}(n),a}function J(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return G(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return G(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw i}}}}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Q(e){var t=e.isVideo,r=e.switchPlayer,n=e.handleIsEnded,o=L(e,["isVideo","switchPlayer","handleIsEnded"]),u=I(),s=C(),l=k(),c=O(),m=l.manifest,p=l.canvasIndex,y=l.currentNavItem,v=u.isClicked,g=u.isEnded,h=u.isPlaying,b=u.player,T=u.startTime,j=u.currentTime,x=a.default.useState(p),E=f(x,2),w=E[0],P=E[1],S=a.default.useState(!1),M=f(S,2),A=M[0],R=M[1],q=a.default.useState(null),D=f(q,2),U=D[0],N=D[1],_=a.default.useState(!1),B=f(_,2),F=B[0],H=B[1],V=a.default.useState(!1),G=f(V,2),Q=G[0],X=G[1],Z=a.default.useState([]),ee=f(Z,2),te=ee[0],re=ee[1],ne=a.default.useState(""),ae=f(ne,2),ie=ae[0],oe=ae[1],ue=a.default.useRef(),se=a.default.useRef(),le=a.default.useRef();se.current=ie,le.current=A,a.default.useEffect((function(){var e=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?K(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},o);P(p);var t=i.default(ue.current,e);return N(t),H(!0),s({player:t,type:"updatePlayer"}),function(){t&&(t.dispose(),H(!1),R(!1))}}),[]),a.default.useEffect((function(){b&&F&&(b.on("ready",(function(){console.log("ready"),b.markers({markerTip:{display:!0,text:function(e){return e.text}},markerStyle:{opacity:"0.5","background-color":"#80A590","border-radius":0,height:"16px",top:"-7px"},markers:[]})})),b.on("ended",(function(){console.log("ended"),s({isEnded:!0,type:"setIsEnded"}),fe()})),b.on("loadedmetadata",(function(){console.log("loadedmetadata"),(g||h)&&b.play(),b.currentTime(j),s({isEnded:!1,type:"setIsEnded"}),R(!0)})),b.on("pause",(function(){console.log("pause"),s({isPlaying:!1,type:"setPlayingStatus"})})),b.on("play",(function(){console.log("play"),s({isPlaying:!0,type:"setPlayingStatus"})})),b.on("seeked",(function(){ce()})),b.on("timeupdate",(function(){de()})))}),[b]),a.default.useEffect((function(){v&&p!==w&&r(),P(p),re(z({manifest:m,canvasIndex:p}))}),[p]),a.default.useEffect((function(){if(b&&U)if(null!==y&&A){if(b.markers){b.markers.removeAll();var e=W(Y(y)),t=e.start,r=e.stop;s({endTime:r,startTime:t,type:"setTimeFragment"}),b.markers.add([{time:t,duration:r-t,text:y.label.en[0]}])}}else if(null===T){var n=z({manifest:m,canvasIndex:p})[0],a=W(Y(n));a&&0===a.start&&c({item:n,type:"switchItem"})}}),[y,A]),a.default.useEffect((function(){null!==b&&A&&b.currentTime(j,s({type:"resetClick"}))}),[v]),a.default.useEffect((function(){b&&U&&0==Q&&b.markers&&b.markers.removeAll()}),[Q]);var ce=function(){if(null!==b&&le.current){var e=b.currentTime();s({currentTime:e,type:"setCurrentTime"});var t=me(e);t?(X(!0),c({item:t,type:"switchItem"})):X(!1)}},fe=function(){if($({canvasIndex:p,manifest:m})){c({canvasIndex:p+1,type:"switchCanvas"}),s({startTime:0,type:"setTimeFragment"}),s({currentTime:0,type:"setCurrentTime"});var e=function(e){var t=e.canvasIndex,r=e.manifest;if($({canvasIndex:t,manifest:r})&&r.structures){var n=r.structures[0].items[t+1];if(n.items)return n.items[0]}return null}({canvasIndex:p,manifest:m});0===W(Y(e)).start?(X(!0),c({item:e,type:"switchItem"})):c({item:null,type:"switchItem"}),n(),P(w+1)}},de=function(){if(null!==b&&le.current){var e=me(b.currentTime());e&&se.current!=e.id?(oe(e.id),X(!0),c({item:e,type:"switchItem"})):null===e&&b.markers&&X(!1)}},me=function(e){var t,r=J(te);try{for(r.s();!(t=r.n()).done;){var n=t.value,a=W(Y(n)),i=a.start,o=a.stop;if(e>=i&&e<o)return n}}catch(e){r.e(e)}finally{r.f()}return null};return a.default.createElement("div",{"data-vjs-player":!0},t?a.default.createElement("video",{"data-testid":"videojs-video-element",ref:ue,className:"video-js"}):a.default.createElement("audio",{"data-testid":"videojs-audio-element",ref:ue,className:"video-js vjs-default-skin"}))}require("@silvermine/videojs-quality-selector")(i.default),Q.propTypes={isVideo:q.bool,switchPlayer:q.func,handleIsEnded:q.func,videoJSOptions:q.object};var X=function(e){var t=e.message,r=void 0===t?"You forgot to include an error message":t;return a.default.createElement("div",{className:"rimp__"},"ERROR: ",r)};function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}X.propTypes={message:q.string.isRequired};var te=function(){var t=k(),n=I(),i=e.useState({error:"",sourceType:"",sources:[],tracks:[],poster:null}),o=f(i,2),u=o[0],s=o[1],l=e.useState(!1),c=f(l,2),d=c[0],m=c[1],p=e.useState(h),y=f(p,2),v=y[0],g=y[1],h=t.canvasIndex,b=t.manifest;n.player;if(e.useEffect((function(){b&&O(h)}),[b,h]),u.error)return a.default.createElement(X,{message:u.error});var O=function(e){var t=function(e){var t,n=e.manifest,a=e.canvasIndex,i=[],o=[],u=!1;try{t=r.parseManifest(n).getSequences()[0].getCanvases()[a].getContent()[0].getBody()}catch(e){return console.log("error fetching content",e),{error:"Error fetching content"}}if(0===t.length)return{error:"No media sources found"};try{t.map((function(e){if("text"==e.getType()){var t={src:e.id,kind:e.getFormat(),label:e.getLabel()[0]?e.getLabel()[0].value:"",srclang:e.getProperty("language")};o.push(t)}else{var r={src:e.id,type:e.getFormat()?e.getFormat():"application/x-mpegurl",label:e.getLabel()[0]?e.getLabel()[0].value:"auto"};i.push(r)}}));var s,l=F(i);try{for(l.s();!(s=l.n()).done;){var c=s.value;"auto"!=c.label||u||(u=!0,c.selected=!0)}}catch(e){l.e(e)}finally{l.f()}u||(i[0].selected=!0);var f=t.map((function(e){return e.getType()})),d=f.filter((function(e,t){return f.indexOf(e)===t})),m=1===d.length?d[0]:"video";return{sources:i,tracks:o,mediaType:m,error:null}}catch(e){return{error:"Manifest cannot be parsed."}}}({manifest:b,canvasIndex:e}),n=t.sources,a=t.tracks,i=t.mediaType,o=t.error;s(ee(ee({},u),{},{error:o,sourceType:i,sources:n,tracks:a})),g(e),m(!o)},T={aspectRatio:"audio"===u.sourceType?"1:0":"16:9",autoplay:!1,bigPlayButton:!1,controls:!0,fluid:!0,controlBar:{children:["playToggle","volumePanel","progressControl","remainingTimeDisplay","subsCapsButton","qualitySelector","pictureInPictureToggle"],volumePanel:{inline:!1},fullscreenToggle:"audio"!==u.sourceType},sources:u.sources,tracks:u.tracks};return d?a.default.createElement("div",{"data-testid":"media-player",key:"media-player-".concat(v)},a.default.createElement(Q,N({isVideo:"video"===u.sourceType,switchPlayer:function(){O(h)},handleIsEnded:function(){O(h+1)}},T))):null};te.propTypes={};var re=function(t){var r,n=t.item,i=t.isTitle,o=C(),u=O(),s=k(),l=s.manifest,c=s.currentNavItem,f=V({rangeId:n.id,manifest:l}),d=n.items&&n.items.length>0&&0===f.length?a.default.createElement(ne,{items:n.items,isChild:!0}):null,m=e.useRef(null),p=function(e){e.stopPropagation(),e.preventDefault(),o({clickedUrl:e.target.href,type:"navClick"}),u({item:n,type:"switchItem"})};return e.useEffect((function(){c==n&&(m.current.className+=" active")}),[c]),""!=n.label?a.default.createElement("li",{"data-testid":"list-item",ref:m,className:"irmp--structured-nav__list-item"},(r=function(e){var t=function(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")};if(e&&"object"===B(e)){var r=Object.keys(e);if(r&&r.length>0){var n=r[0];return e[n].length>0?t(e[n][0]):""}}else if("string"==typeof e)return t(e);return"Label could not be parsed"}(n.label),f.length>0?f.map((function(e){return a.default.createElement("a",{key:e,href:e,onClick:p},r)})):i?a.default.createElement("span",{className:"irmp--structured-nav__section-title"},r):null),d):null};re.propTypes={item:q.object.isRequired,isChild:q.bool,isTitle:q.bool};var ne=function e(t){var n=k();if(!n.manifest)return a.default.createElement("p",{"data-testid":"list-error"},"No manifest in List yet");var i=a.default.createElement("ul",{"data-testid":"list",className:"irmp--structured-nav__list"},t.items.map((function(i){var o=function(e){var t=e.item,n=e.manifest,a=r.parseManifest(n).getRangeById(t.id);if(a){var i=a.getBehavior();return i&&"no-nav"===i?null:t}}({item:i,manifest:n.manifest});return o?0==V({rangeId:o.id,manifest:n.manifest}).length?a.default.createElement(re,{key:o.id,item:o,isChild:!1,isTitle:!0,titles:t.titles}):a.default.createElement(re,{key:o.id,item:o,isChild:t.isChild,isTitle:!1,titles:t.titles}):a.default.createElement(e,{items:i.items,isChild:!0,titles:t.titles})})));return a.default.createElement(a.default.Fragment,null,i)};ne.propTypes={items:q.array.isRequired,isChild:q.bool.isRequired};var ae=function(){var t=O(),n=k(),i=C(),o=I(),u=o.isClicked,s=o.clickedUrl,l=(o.player,n.canvasId,n.manifest);return e.useEffect((function(){if(u){var e=function(e){return r.parseManifest(e).getSequences()[0].getCanvases().map((function(e){var t=e.getContent()[0].getBody().map((function(e){return e.id}));return{canvasId:e.id,canvasSources:t}}))}(l),a=e.find((function(e){return function(e){if(void 0!==e)return e.split("#t=")[0].split("/").reverse()[0]}(s)===e.canvasId.split("/").reverse()[0]})),o=e.indexOf(a),c=W(s);if(!c||null==c)return void console.error("Error retrieving time fragment object from Canvas URL in structured navigation");n.canvasIndex!=o&&t({canvasIndex:o,type:"switchCanvas"}),i({startTime:c.start,endTime:c.stop,type:"setTimeFragment"}),i({currentTime:c.start,type:"setCurrentTime"})}}),[u]),l?l.structures?a.default.createElement("div",{"data-testid":"structured-nav",className:"irmp--structured-nav",key:Math.random()},l.structures[0]&&l.structures[0].items?l.structures[0].items.map((function(e,t){return a.default.createElement(ne,{items:[e],key:t,isChild:!1})})):null):a.default.createElement("p",null,"There are no structures in the manifest."):a.default.createElement("p",null,"No manifest - Please provide a valid manifest.")};ae.propTypes={},exports.IIIFPlayer=U,exports.MediaPlayer=te,exports.StructuredNavigation=ae;
